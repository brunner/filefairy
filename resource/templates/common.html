{% macro nav(modals, anchors) -%}
<!-- ^(common.nav) -->
<button class="navbar-toggler border-0" type="button" data-toggle="collapse"
        data-target="#nav-dropdown" aria-controls="#nav-dropdown"
        aria-expanded="false" aria-label="nav toggler">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse border-top" id="nav-dropdown">
<ul class="navbar-nav">
{% for modal in modals %}
<li class="nav-item">
<span class="nav-link"
      data-toggle="modal"
      data-target="#{{ modal[0] }}">{{ modal[1] }}</a>
</li>
{% endfor %}
{% if modals and anchors %}
<div class="dropdown-divider"></div>
{% endif %}
{% for anchor in anchors %}
<li class="nav-item">
<a class="nav-link" href="#{{ anchor[0] }}">{{ anchor[1] }}</a>
</li>
{% endfor %}
</ul>
</div>
<!-- $(common.nav) -->
{%- endmacro -%}

{% macro heading(icon, text) -%}
<!-- ^(common.heading) -->
<div class="row">
<div class="col-12">
<div class="alert alert-secondary mt-3 mb-0">
<span class="oi oi-{{ icon }} text-secondary"></span>{{ text }}
</div>
</div>
</div>
<!-- $(common.heading) -->
{%- endmacro -%}

{% macro card(data) -%}
<!-- ^(common.card) -->
<div class="card d-flex flex-column flex-grow mt-3">

<!-- ^(common.card.body) -->
<div class="card-body d-flex flex-column">
<div class="d-flex flex-row">
<h5 class="card-title flex-grow">
{% if data.href %}
<a href="{{ data.href }}">{{ data.title }}</a>
{% else %}
{{ data.title }}
{% endif %}
</h5>
<div>
{%- if data.success -%}
<span class="btn btn-success btn-sm disabled">{{ data.success }}</span>
{%- elif data.danger -%}
<span class="btn btn-danger btn-sm disabled">{{ data.danger }}</span>
{%- endif -%}
</div>
</div>

{% if data.info %}
<p class="card-text flex-grow">{{ data.info }}</p>
{% endif %}
{% if data.table %}

{{ table(data.table) }}

{% endif %}
{% if data.code %}
<pre class="pre-scrollable d-flex"><code>{{- data.code -}}</code></pre>
{% endif %}
</div>
<!-- $(common.card.body) -->
{% if data.ts %}

<!-- ^(common.card.footer) -->
<div class="card-footer text-muted text-truncate">
<small>Last activity: {{ data.ts }}</small>
</div>
<!-- $(common.card.footer) -->
{% endif %}

</div>
<!-- $(common.card) -->
{%- endmacro -%}

{% macro dropdown(plugin, teams) -%}
<!-- ^(common.dropdown) -->
<div class="row">
<div class="col-12">
<div class="dropdown mt-3 p-0">
<button class="{{ 'btn bg-white dropdown-toggle border w-100 ' +
                  'd-flex justify-content-between align-items-center' }}"
        type="button" id="dropdown-button" data-toggle="dropdown"
        data-flip="false" aria-haspopup="true"
        aria-expanded="false">Select</button>
<div class="dropdown-menu w-100" aria-labelledby="dropdown-button">
{% for name, path in teams %}
<a class="dropdown-item py-2"
   href="{{ plugin + '/' + path.replace(' ', '').lower() + '/' }}">
{{ name }}
</a>
{% endfor %}
</div>
</div>
</div>
</div>
<!-- $(common.dropdown) -->
{%- endmacro -%}

{% macro form() -%}
<!-- ^(common.form) -->
<div class="row">
<div class="col-12">
<nav class="navbar navbar-light bg-light mt-3 p-0">
<form class="w-100">
<input class="form-control border mr-sm-2" type="search" placeholder="Search"
       aria-label="Search">
</form>
</nav>
</div>
</div>
<!-- $(common.form) -->
{%- endmacro -%}

{% macro form_js(ids) -%}
<!-- ^(common.form_js) -->
<script>
var filter = '';
$('.form-control').on('change keyup paste mouseup', function(e) {
  var val = $(this).val().toLowerCase();
  if (val != filter) {
    filter = val;
    $.each({{ ids }}, function(i, v) {
      container = $('#' + v);
      $('tbody td', container).each(function(e) {
        if ($(this).text().toLowerCase().indexOf(filter) != -1) {
          $(this).removeClass('d-none');
        } else {
          $(this).addClass('d-none');
        }
      });
      $('table', container).each(function(e) {
        if ($(this).find('tbody td:not(.d-none)').length != 0) {
          $(this).removeClass('d-none');
        } else {
          $(this).addClass('d-none');
        }
      });
    })
  }
});
</script>
<!-- $(common.form_js) -->
{%- endmacro -%}

{% macro table(data) -%}
<!-- ^(common.table) -->
<table class="table{% if data.clazz %} {{ data.clazz }}{% endif %}"
       {%- if data.id %}id="{{ data.id }}"{% endif %}>
{% if data.head %}

<!-- ^(common.table.head) -->
<thead class="thead-light">
<tr>
{% for cell in data.head %}
{% set hcol = data.hcols[loop.index0] if data.hcols else '' %}
<td scope="col"{{ hcol | safe }}>{{ cell }}</td>
{% endfor %}
</tr>
</thead>
<!-- $(common.table.head) -->
{% endif %}
{% if data.body %}

<!-- ^(common.table.body) -->
<tbody>
{% for row in data.body %}
<tr>
{% for cell in row %}
{% if loop.first %}
{% set bcol = data.bcols[loop.index0] if data.bcols else '' %}
<td scope="row"{{ bcol | safe }}>{{ cell }}</td>
{% else %}
<td{{ data.bcols[loop.index0] | safe }}>{{ cell }}</td>
{% endif %}
{% endfor %}
</tr>
{% endfor %}
</tbody>
<!-- $(common.table.body) -->
{% endif %}
{% if data.foot %}

<!-- ^(common.table.foot) -->
<tfoot class="thead-light">
<tr>
{% for cell in data.foot %}
{% set hcol = data.fcols[loop.index0] if data.fcols else '' %}
<td scope="col"{{ hcol | safe }}>{{ cell }}</td>
{% endfor %}
</tr>
</tfoot>
<!-- $(common.table.foot) -->
{% endif %}

</table>
<!-- $(common.table) -->
{%- endmacro -%}

{% macro tabs(data) -%}
<!-- ^(common.tabs) -->
<div class="container">
<div class="row">
<div class="col-12">

<!-- ^(common.tabs.tabs) -->
<ul class="nav nav-tabs mt-3" role="tablist">

{% for t in data.tabs %}
<li class="nav-item">
{% set active = ' active' if loop.first else '' %}
<a class="nav-link{{ active }}" id="{{ t.name }}-tab" data-toggle="tab"
   href="#{{ t.name }}" role="tab" aria-controls="raw" aria-selected="true">
{{ t.title }}
</a>
</li>

{% endfor %}
</ul>
<!-- $(common.tabs.tabs) -->

<!-- ^(common.tabs.content) -->
<div class="tab-content">

{% for t in data.tabs %}
{% set active = ' active' if loop.first else '' %}
<div class="tab-pane fade show{{ active }}" id="{{ t.name }}"
     role="tabpanel" aria-labelledby="{{ t.name }}-tab">

<!-- ^(common.tabs.content.tables) -->
{% for u in t.tables %}
{{ table(u) }}

{% endfor %}
<!-- $(common.tabs.content.tables) -->
</div>

{% endfor %}
</div>
<!-- $(common.tabs.content) -->

</div>
</div>
</div>
<!-- $(common.tabs) -->
{%- endmacro -%}

{% macro modal(trigger, name, tables) -%}
<div class="modal fade"
     id="{{ trigger }}"
     tabindex="-1"
     role="dialog"
     aria-labelledby="{{ trigger }}-modal-label" aria-hidden="true">

<!-- ^(common.modal.head) -->
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="{{ trigger }}-modal-label">{{ name }}</h5>
<button type="button" class="close" data-dismiss="modal" aria-label="Close">
<span aria-hidden="true">&times;</span>
</button>
</div>
<!-- $(common.modal.head) -->

<!-- ^(common.modal.body) -->
<div class="modal-body">

{% for t in tables %}
{{ table(t) }}

{% endfor %}
</div>
<!-- $(common.modal.body) -->

</div>
{%- endmacro -%}
